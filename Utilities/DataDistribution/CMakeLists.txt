# Remove when API stabilizes
add_definitions(-DUSE_MULTIPART=1)
add_definitions(-DSTF_SERIALIZATION=1)

add_subdirectory (Common)
add_subdirectory (ReadoutEmulator)
add_subdirectory (SubTimeFrameBuilder)
add_subdirectory (SubTimeFrameSender)

add_subdirectory (TimeFrameBuilder)


# (FLP) Chain configuration and run script for Readout-Emulation mode (no CRU)
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/run/startReadoutFLPChain.sh.in
                       ${CMAKE_BINARY_DIR}/bin/startReadoutFLPChain.sh)
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/run/readout-flp-chain.json
                       ${CMAKE_BINARY_DIR}/bin/config/readout-flp-chain.json)

# (FLP+EPN) Chain configuration and run script for Readout-Emulation mode (no CRU)
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/run/readout-emu-flp-epn-chain.json
                       ${CMAKE_BINARY_DIR}/bin/config/readout-emu-flp-epn-chain.json)

configure_file(${CMAKE_CURRENT_SOURCE_DIR}/run/start_Emulator-FLP-EPN.sh.in
                       ${CMAKE_BINARY_DIR}/bin/start_Emulator-FLP-EPN.sh)

configure_file(${CMAKE_CURRENT_SOURCE_DIR}/run/start_Emulator-3FLP-3EPN.sh.in
                       ${CMAKE_BINARY_DIR}/bin/start_Emulator-3FLP-3EPN.sh)



# (FLP) Chain configuration and run script for Readout+DataDist mode (no CRU needed)
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/run/startFLPReadoutDataDistEMU.sh.in
                       ${CMAKE_BINARY_DIR}/bin/startFLPReadoutDataDistEMU.sh)
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/run/readout-flp-chain-emu.json
                       ${CMAKE_BINARY_DIR}/bin/config/readout-flp-chain-emu.json)
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/run/readout_cfg/readout_emu.cfg
                       ${CMAKE_BINARY_DIR}/bin/config/readout_cfg/readout_emu.cfg)

# (FLP+EPN) Chain configuration and run script for Readout+DataDist mode (no CRU needed)
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/run/start_ReadoutEMU-FLP-EPN.sh.in
                       ${CMAKE_BINARY_DIR}/bin/start_ReadoutEMU-FLP-EPN.sh)



# DDS topologies
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/run/flp-epn-dds-topology.xml
                       ${CMAKE_BINARY_DIR}/bin/config/flp-epn-dds-topology.xml COPYONLY)

install(FILES ${CMAKE_BINARY_DIR}/bin/startReadoutFLPChain.sh
              ${CMAKE_BINARY_DIR}/bin/startFLPReadoutDataDistEMU.sh
              ${CMAKE_BINARY_DIR}/bin/start_Emulator-FLP-EPN.sh
  DESTINATION ${CMAKE_INSTALL_PREFIX}/bin
  PERMISSIONS OWNER_READ OWNER_WRITE OWNER_EXECUTE GROUP_READ WORLD_READ)

install(FILES ${CMAKE_BINARY_DIR}/bin/config/readout-flp-chain.json
              ${CMAKE_BINARY_DIR}/bin/config/readout-flp-chain-emu.json
              ${CMAKE_BINARY_DIR}/bin/config/readout_cfg/readout_emu.cfg
              ${CMAKE_BINARY_DIR}/bin/config/readout-emu-flp-epn-chain.json
              ${CMAKE_BINARY_DIR}/bin/config/flp-epn-dds-topology.xml
  DESTINATION ${CMAKE_INSTALL_PREFIX}/bin/config)

